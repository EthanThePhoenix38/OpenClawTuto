# =============================================================================
# OpenClaw Kubernetes Secrets
# Version: 1.0.0
# Auteur: Ethan Bernier (ORCID: 0009-0008-9839-5763)
# Description: Secrets pour les clés API et données sensibles
# =============================================================================
#
# ⚠️  IMPORTANT - SÉCURITÉ ⚠️
# ============================================================================
# Ce fichier est un TEMPLATE. Ne JAMAIS commiter de vraies clés !
#
# Pour créer les secrets en production :
#
# 1. Via kubectl (recommandé) :
#    kubectl create secret generic openclaw-api-keys \
#      --from-literal=anthropic-api-key=sk-ant-xxx \
#      --from-literal=openai-api-key=sk-xxx \
#      -n openclaw
#
# 2. Via fichier .env (ne pas commiter) :
#    kubectl create secret generic openclaw-api-keys \
#      --from-env-file=.env.secrets \
#      -n openclaw
#
# 3. Via gestionnaire de secrets externe :
#    - HashiCorp Vault
#    - AWS Secrets Manager
#    - Azure Key Vault
#    - GCP Secret Manager
#
# ============================================================================

---
# =============================================================================
# Secret pour les clés API LLM
# TEMPLATE - Remplacer les valeurs base64 par vos vraies clés encodées
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: openclaw-api-keys
  namespace: openclaw
  labels:
    app.kubernetes.io/name: openclaw
    app.kubernetes.io/instance: openclaw-production
    app.kubernetes.io/version: "2026.1.30"
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: openclaw-stack
    app: openclaw
  annotations:
    description: "Clés API pour les fournisseurs LLM cloud"
    # Annotations pour rotation automatique (si vault configuré)
    # vault.hashicorp.com/agent-inject: "true"
    # vault.hashicorp.com/role: "openclaw"
type: Opaque
data:
  # ⚠️ TEMPLATE - Ces valeurs sont des placeholders !
  # Pour encoder une clé : echo -n "votre-clé" | base64
  # Pour décoder : echo "valeur-base64" | base64 -d

  # Anthropic API Key (Claude)
  # Valeur actuelle = "REPLACE_WITH_YOUR_ANTHROPIC_KEY" encodé
  anthropic-api-key: UkVQTEFDRV9XSVRIX1lPVVJfQU5USFJPUEJDX0tFWQ==

  # OpenAI API Key (GPT) - Optionnel
  # Valeur actuelle = "REPLACE_WITH_YOUR_OPENAI_KEY" encodé
  openai-api-key: UkVQTEFDRV9XSVRIX1lPVVJfT1BFTkFJX0tFWQ==

  # Google AI API Key (Gemini) - Optionnel
  # Valeur actuelle = "REPLACE_WITH_YOUR_GOOGLE_KEY" encodé
  google-api-key: UkVQTEFDRV9XSVRIX1lPVVJfR09PR0xFX0tFWQ==

---
# =============================================================================
# Secret pour les credentials de monitoring
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: openclaw-monitoring
  namespace: openclaw
  labels:
    app.kubernetes.io/name: openclaw
    app.kubernetes.io/component: monitoring-secrets
    app: openclaw
  annotations:
    description: "Credentials pour Grafana et alerting"
type: Opaque
data:
  # Grafana admin password
  # Valeur = "REPLACE_WITH_GRAFANA_PASSWORD" encodé
  grafana-admin-password: UkVQTEFDRV9XSVRIX0dSQUZBTkFfUEFTU1dPUkQ=

  # ntfy.sh topic (pour alertes push)
  # Valeur = "REPLACE_WITH_NTFY_TOPIC" encodé
  ntfy-topic: UkVQTEFDRV9XSVRIX05URllfVE9QSUM=

---
# =============================================================================
# Secret pour les tokens d'accès
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: openclaw-tokens
  namespace: openclaw
  labels:
    app.kubernetes.io/name: openclaw
    app.kubernetes.io/component: tokens
    app: openclaw
  annotations:
    description: "Tokens d'authentification et accès"
type: Opaque
data:
  # Token JWT pour l'API Gateway (optionnel)
  # Générer avec : openssl rand -base64 32
  jwt-secret: UkVQTEFDRV9XSVRIX0pXVF9TRUNSRVQ=

  # Token pour webhooks (optionnel)
  webhook-token: UkVQTEFDRV9XSVRIX1dFQkhPT0tfVE9LRU4=

---
# =============================================================================
# Secret pour TLS (si HTTPS interne requis)
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: openclaw-tls
  namespace: openclaw
  labels:
    app.kubernetes.io/name: openclaw
    app.kubernetes.io/component: tls
    app: openclaw
  annotations:
    description: "Certificats TLS pour communication interne"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
type: kubernetes.io/tls
data:
  # Certificat TLS (auto-signé pour usage local)
  # Générer avec : openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  #                -keyout tls.key -out tls.crt -subj "/CN=openclaw.local"
  tls.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lKQUlB
    UkVQTEFDRV9XSVRIX1lPVVJfQ0VSVElGSUNBVEUKLS0tLS1FTkQgQ0VSVElGSUNBVEUt
    LS0tLQo=
  tls.key: |
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUJWUUlCQURBTkJna3Foa2lHOXcw
    UkVQTEFDRV9XSVRIX1lPVVJfUFJJVkFURV9LRVkKLS0tLS1FTkQgUFJJVkFURSBLRVkt
    LS0tLQo=

---
# =============================================================================
# INSTRUCTIONS DE DÉPLOIEMENT
# =============================================================================
#
# MÉTHODE 1 : Création manuelle (recommandée pour production)
# -----------------------------------------------------------
#
# # Créer les secrets API
# kubectl create secret generic openclaw-api-keys \
#   --from-literal=anthropic-api-key='sk-ant-api03-xxxxx' \
#   --from-literal=openai-api-key='sk-xxxxx' \
#   --from-literal=google-api-key='AIzaxxxxx' \
#   -n openclaw
#
# # Créer les secrets monitoring
# kubectl create secret generic openclaw-monitoring \
#   --from-literal=grafana-admin-password='MonMotDePasseSecure123!' \
#   --from-literal=ntfy-topic='openclaw-alerts-xxxxx' \
#   -n openclaw
#
# # Créer les tokens
# JWT_SECRET=$(openssl rand -base64 32)
# kubectl create secret generic openclaw-tokens \
#   --from-literal=jwt-secret="$JWT_SECRET" \
#   --from-literal=webhook-token="$(openssl rand -hex 16)" \
#   -n openclaw
#
#
# MÉTHODE 2 : Fichier .env.secrets (ne pas commiter !)
# -----------------------------------------------------------
#
# Créer un fichier .env.secrets :
#   ANTHROPIC_API_KEY=sk-ant-xxx
#   OPENAI_API_KEY=sk-xxx
#
# Puis :
#   kubectl create secret generic openclaw-api-keys \
#     --from-env-file=.env.secrets \
#     -n openclaw
#
#
# MÉTHODE 3 : SealedSecrets (GitOps friendly)
# -----------------------------------------------------------
#
# kubeseal < secrets.yaml > sealed-secrets.yaml
# kubectl apply -f sealed-secrets.yaml
#
#
# VÉRIFICATION
# -----------------------------------------------------------
#
# # Lister les secrets
# kubectl get secrets -n openclaw
#
# # Voir un secret (encodé)
# kubectl get secret openclaw-api-keys -n openclaw -o yaml
#
# # Décoder une valeur
# kubectl get secret openclaw-api-keys -n openclaw \
#   -o jsonpath='{.data.anthropic-api-key}' | base64 -d
#
# =============================================================================
